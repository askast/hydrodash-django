{% extends "profiles/stislabase.html" %}
{% load static %}
{% load render_table from django_tables2 %}

{% block extrahead %}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/select/1.3.0/css/select.bootstrap4.min.css">
<link rel="stylesheet" type="text/css"
    href="https://cdn.datatables.net/responsive/1.0.7/css/responsive.dataTables.min.css">

<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js" defer type="text/javascript"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js" defer type="text/javascript"></script>
<script src="https://cdn.datatables.net/select/1.3.0/js/dataTables.select.min.js" defer type="text/javascript"></script>
<script src="https://cdn.datatables.net/select/1.3.0/js/select.bootstrap4.min.js" defer type="text/javascript"></script>
<script src="https://cdn.datatables.net/plug-ins/1.10.19/dataRender/datetime.js" defer type="text/javascript"></script>
<script src="https://cdn.datatables.net/responsive/1.0.7/js/dataTables.responsive.min.js" defer type="text/javascript">
</script>
<script src="https://www.amcharts.com/lib/4/core.js"></script>
<script src="https://www.amcharts.com/lib/4/charts.js"></script>
<script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>
<!-- including ECharts file -->
<script src="{% static 'profiles/js/echarts.js' %}"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>

{% endblock %}

{% block content %}

<div class="main-content">
    <section class="section">
        <div class="section-header">
            <h1>Raw Test Data</h1>
            {% comment %} <h>, {{ servername }}</h1> {% endcomment %}
                <div class="section-header-breadcrumb">
                    <div class="breadcrumb-item active"><a href="#">Dashboard</a></div>
                    <div class="breadcrumb-item"><a href="#">Raw Test Data</a></div>
                    <div class="breadcrumb-item"><a href="#">Test List</a></div>
                    <div class="breadcrumb-item"><a href="#">Test List</a></div>
                </div>
        </div>
        <h2 class="section-title">Test Name</h2>
        <p style="text-align:left;" class="section-lead">
            {{ testname }}
            <span style="float:right;">To view data without first and last points click <a
                    href="{% url 'rawtestplotview'%}?rawtestid={{ testid }}&removefirstlast=true">here</a>.</span>
        </p>
        <p style="text-align:left;" class="section-lead">Data shown here is displayed as it is from the data aquisition
            system. Corrections for Pipe size and RPM have not been applied to it. Only for Reference.
        </p>
        <div class="section-body">
            <div class="row">
                <div class="col-12 col-md-6 col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h4>Flow</h4>
                        </div>
                        <div class="card-body">
                            <div id="chart1" class="chart">

                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-6 col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h4>Head</h4>
                        </div>
                        <div class="card-body">
                            <div id="chart2" class="chart">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 col-md-6 col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h4>Power</h4>
                        </div>
                        <div class="card-body">
                            <div id="chart3" class="chart">

                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-6 col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h4>Efficiency</h4>
                        </div>
                        <div class="card-body">
                            <div id="chart4" class="chart">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h4>Head vs Flow</h4>
                        </div>
                        <div class="card-body">
                            <div id="chart5" class="chart">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h4>Test name: {{ testname }}</h4>
                        </div>
                        <div class="card-body">
                            {% render_table tables.0 %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<script>
    $(document).ready(function () {
        var removefl = "{{removefl}}";
        console.log(removefl);

        var table1 = $('#table1').DataTable({
            select: {
                style: 'multi'
            },
            "order": [
                [0, "desc"]
            ],
            columnDefs: [{
                className: "text-center",
                targets: [2]
            }],
            responsive: true,
            searching: true,
            processing: true,
            stateSave: true
        });

        var basechartoptions = {
            chart: {
                zoomType: 'x'
            },
            title: {
                text: ''
            },
            xAxis: {
                minorTickInterval: 'auto',
                gridLineWidth: 1
            },
            yAxis: {
                minorTickInterval: 'auto',
                gridLineWidth: 1
            },
            legend: {
                enabled: false
            },
            plotOptions: {
                scatter: {
                    marker: {
                        radius: 3
                    }
                }
            },
            series: [{
                type: 'scatter'
            }],
            exporting: {
                enabled: false
            }
        };

        $.getJSON(
            "{% url 'rawtestplotdata' %}?rawtestid={{ testid }}&removefirstlast={{ removefl }}",
            function (data) {
                chart1data = [];
                chart2data = [];
                chart3data = [];
                chart4data = [];
                chart5data = [];
                for (var i = 0; i < data.chartdate.length; i++) {
                    chart1data.push([data.chartdate[i], data.chartflow[i]]);
                    chart2data.push([data.chartdate[i], data.charthead[i]]);
                    chart3data.push([data.chartdate[i], data.chartpower[i]]);
                    chart4data.push([data.chartdate[i], data.charteff[i]]);
                    chart5data.push([data.chartflow[i], data.charthead[i]]);
                }

                basechartoptions.series[0].data = chart1data;
                basechartoptions.xAxis.type = "datetime";
                basechartoptions.xAxis.title = {
                    text: 'Time'
                };
                basechartoptions.yAxis.title = {
                    text: 'Flow'
                };
                Highcharts.chart('chart1', basechartoptions);

                basechartoptions.series[0].data = chart2data;
                basechartoptions.xAxis.type = "datetime";
                basechartoptions.xAxis.title = {
                    text: 'Time'
                };
                basechartoptions.yAxis.title = {
                    text: 'Head'
                };
                Highcharts.chart('chart2', basechartoptions);

                basechartoptions.series[0].data = chart3data;
                basechartoptions.xAxis.type = "datetime";
                basechartoptions.xAxis.title = {
                    text: 'Time'
                };
                basechartoptions.yAxis.title = {
                    text: 'Power'
                };
                Highcharts.chart('chart3', basechartoptions);

                basechartoptions.series[0].data = chart4data;
                basechartoptions.xAxis.type = "datetime";
                basechartoptions.xAxis.title = {
                    text: 'Time'
                };
                basechartoptions.yAxis.title = {
                    text: 'Efficiency'
                };
                Highcharts.chart('chart4', basechartoptions);

                basechartoptions.series[0].data = chart5data;
                basechartoptions.xAxis.type = "";
                basechartoptions.xAxis.title = {
                    text: 'Flow'
                };
                basechartoptions.yAxis.title = {
                    text: 'Head'
                };
                Highcharts.chart('chart5', basechartoptions);
            }
        );


    });
</script>
{% endblock content%}