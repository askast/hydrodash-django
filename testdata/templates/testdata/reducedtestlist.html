{% extends "profiles/stislabase.html" %}


{% block extrahead %}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/select/1.3.0/css/select.bootstrap4.min.css">
<link rel="stylesheet" type="text/css"
    href="https://cdn.datatables.net/responsive/1.0.7/css/responsive.dataTables.min.css">

<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js" defer type="text/javascript"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js" defer type="text/javascript"></script>
<script src="https://cdn.datatables.net/select/1.3.0/js/dataTables.select.min.js" defer type="text/javascript"></script>
<script src="https://cdn.datatables.net/select/1.3.0/js/select.bootstrap4.min.js" defer type="text/javascript"></script>
<script src="https://cdn.datatables.net/plug-ins/1.10.19/dataRender/datetime.js" defer type="text/javascript"></script>
<script src="https://cdn.datatables.net/responsive/1.0.7/js/dataTables.responsive.min.js" defer type="text/javascript">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.26/moment-timezone-with-data.min.js" defer
    type="text/javascript"></script>

{% endblock %}

{% block content %}

<div class="main-content">
    <section class="section">
        <div class="section-header">
            <h1>Reduced Tests Lists</h1>
            {% comment %} <h1>, {{ servername }}</h1> {% endcomment %}
            <div class="section-header-breadcrumb">
                <div class="breadcrumb-item active"><a href="#">Dashboard</a></div>
                <div class="breadcrumb-item"><a href="#">Reduced Test Data</a></div>
                <div class="breadcrumb-item">Test List</div>
            </div>
        </div>

        <div class="section-body">
            <h2 class="section-title">Test Database</h2>
            <p class="section-lead">Links to cleaned test data. Double click any test to view peformance plots and other
                details.
            </p>
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h4>Commercial Efficiency Tests</h4>
                        </div>
                        <div class="card-body">
                            <table class="table table-hover responsive" id="table1">
                                <thead>
                                    <th>ID</th>
                                    <th>Test Date</th>
                                    <th>Test Name</th>
                                    <th>Test Engineer</th>
                                    <th>Test Loop</th>
                                    <th>Discharge Pipe Size</th>
                                    <th>Inlet Pipe Size</th>
                                    <th>BEP Flow</th>
                                    <th>BEP Head</th>
                                    <th>BEP Efficiency</th>
                                    <th>PEIcl</th>
                                    <th>PEIvl</th>
                                    <th>Pump Type</th>
                                    <th>Impeller Diameter</th>
                                    <th>Full Trim</th>
                                    <th>Bearing Frame</th>
                                    <th>Data Sources</th>
                                    <th>Description</th>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<script>
    $(document).ready(function () {
        var REFERENCE = moment(); // fixed just for testing, use moment();
        var TODAY = REFERENCE.clone().startOf('day');

        function isToday(momentDate) {
            return momentDate.isSame(TODAY, 'd');
        }

        var table1 = $('#table1').DataTable({
            autoWidth: false,
            select: {
                style: 'multi'
            },
            order: [
                [0, "desc"]
            ],
            columnDefs: [{
                    className: "text-center",
                    targets: [0, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]
                },
                {
                    targets: 1,
                    render: function (data) {
                        return (isToday(moment(data))) ?
                            moment(data).tz("America/Toronto").format("h:mm a") : moment(data)
                            .tz("America/Toronto").format("MMM Do, YYYY");
                    }
                },
                {
                    targets: [5, 6, 7, 8, 9, 10, 11],
                    render: function (data) {
                        if (data == null)
                            return null
                        else
                            return parseFloat(data).toFixed(2);
                    }
                },
                {
                    render: function (data, type, row, ) {
                        return (data === true) ?
                            data = '<span class="true">✔</span>' :
                            data = '<span class="false">✘</span>';
                    },
                    targets: 14
                }
            ],
            responsive: true,
            searching: true,
            processing: true,
            serverSide: true,
            stateSave: true,
            ajax: "{% url 'reducedtestlist-json' %}",
        });

        table1.on('dblclick', 'tr', function () {
            var id = (table1.row(this).data())[0]
            console.log(id);
            window.location = "{% url 'reducedtestplotview' %}?testid=" + id;
        });
    });
</script>
{% endblock content%}